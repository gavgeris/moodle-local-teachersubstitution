{"version":3,"file":"dropdowns.min.js","sources":["../src/dropdowns.js"],"sourcesContent":["/**\r\n * Teacher Substitution Plugin - Dynamic dropdown functionality\r\n *\r\n * @package    local_teachersubstitution\r\n * @copyright  2025\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(['jquery', 'core/ajax', 'core/notification'], function($, Ajax, Notification) {\r\n    \r\n    var init = function() {\r\n        var categorySelect = $('#categoryid');\r\n        var courseSelect = $('#courseid');\r\n        var currentTeacherSelect = $('#currentteacher');\r\n        var newTeacherSelect = $('#newteacher');\r\n        var submitBtn = $('#submitbtn');\r\n        \r\n        // Category change handler\r\n        categorySelect.on('change', function() {\r\n            var categoryId = $(this).val();\r\n            \r\n            // Reset dependent dropdowns\r\n            courseSelect.val('').prop('disabled', true);\r\n            currentTeacherSelect.val('').prop('disabled', true);\r\n            newTeacherSelect.val('').prop('disabled', true);\r\n            submitBtn.prop('disabled', true);\r\n            \r\n            if (categoryId) {\r\n                loadCourses(categoryId);\r\n            }\r\n        });\r\n        \r\n        // Course change handler\r\n        courseSelect.on('change', function() {\r\n            var courseId = $(this).val();\r\n            \r\n            // Reset dependent dropdowns\r\n            currentTeacherSelect.val('').prop('disabled', true);\r\n            newTeacherSelect.val('').prop('disabled', true);\r\n            submitBtn.prop('disabled', true);\r\n            \r\n            if (courseId) {\r\n                loadTeachers(courseId);\r\n            }\r\n        });\r\n        \r\n        // Current teacher change handler\r\n        currentTeacherSelect.on('change', function() {\r\n            var courseId = courseSelect.val();\r\n            \r\n            // Reset new teacher dropdown\r\n            newTeacherSelect.val('').prop('disabled', true);\r\n            submitBtn.prop('disabled', true);\r\n            \r\n            if ($(this).val() && courseId) {\r\n                loadAvailableTeachers(courseId);\r\n            }\r\n        });\r\n        \r\n        // New teacher change handler\r\n        newTeacherSelect.on('change', function() {\r\n            if ($(this).val() && currentTeacherSelect.val()) {\r\n                submitBtn.prop('disabled', false);\r\n            } else {\r\n                submitBtn.prop('disabled', true);\r\n            }\r\n        });\r\n        \r\n        // Form submission handler\r\n        $('#teachersubstitutionform').on('submit', function(e) {\r\n            if (!validateForm()) {\r\n                e.preventDefault();\r\n                Notification.alert('Error', 'Please fill in all required fields.');\r\n            }\r\n        });\r\n        \r\n        function loadCourses(categoryId) {\r\n            Ajax.call([{\r\n                methodname: 'local_teachersubstitution_get_courses',\r\n                args: { categoryid: parseInt(categoryId) },\r\n                done: function(response) {\r\n                    courseSelect.empty().append('<option value=\"\">' + \r\n                        M.util.get_string('selectcourse', 'local_teachersubstitution') + '</option>');\r\n                    \r\n                    if (response.courses && response.courses.length > 0) {\r\n                        $.each(response.courses, function(index, course) {\r\n                            courseSelect.append('<option value=\"' + course.id + '\">' + \r\n                                course.fullname + '</option>');\r\n                        });\r\n                        courseSelect.prop('disabled', false);\r\n                    }\r\n                },\r\n                fail: function(error) {\r\n                    Notification.alert('Error', 'Failed to load courses: ' + error.message);\r\n                }\r\n            }]);\r\n        }\r\n        \r\n        function loadTeachers(courseId) {\r\n            Ajax.call([{\r\n                methodname: 'local_teachersubstitution_get_teachers',\r\n                args: { courseid: parseInt(courseId) },\r\n                done: function(response) {\r\n                    currentTeacherSelect.empty().append('<option value=\"\">' + \r\n                        M.util.get_string('selectcurrentteacher', 'local_teachersubstitution') + '</option>');\r\n                    \r\n                    if (response.teachers && response.teachers.length > 0) {\r\n                        $.each(response.teachers, function(index, teacher) {\r\n                            currentTeacherSelect.append('<option value=\"' + teacher.username + '\">' + \r\n                                teacher.fullname + '</option>');\r\n                        });\r\n                        currentTeacherSelect.prop('disabled', false);\r\n                    }\r\n                },\r\n                fail: function(error) {\r\n                    Notification.alert('Error', 'Failed to load teachers: ' + error.message);\r\n                }\r\n            }]);\r\n        }\r\n        \r\n        function loadAvailableTeachers(courseId) {\r\n            Ajax.call([{\r\n                methodname: 'local_teachersubstitution_get_available_teachers',\r\n                args: { courseid: parseInt(courseId) },\r\n                done: function(response) {\r\n                    newTeacherSelect.empty().append('<option value=\"\">' + \r\n                        M.util.get_string('selectnewteacher', 'local_teachersubstitution') + '</option>');\r\n                    \r\n                    if (response.availableteachers && response.availableteachers.length > 0) {\r\n                        $.each(response.availableteachers, function(index, teacher) {\r\n                            newTeacherSelect.append('<option value=\"' + teacher.username + '\">' + \r\n                                teacher.fullname + '</option>');\r\n                        });\r\n                        newTeacherSelect.prop('disabled', false);\r\n                    }\r\n                },\r\n                fail: function(error) {\r\n                    Notification.alert('Error', 'Failed to load available teachers: ' + error.message);\r\n                }\r\n            }]);\r\n        }\r\n        \r\n        function validateForm() {\r\n            return categorySelect.val() && \r\n                   courseSelect.val() && \r\n                   currentTeacherSelect.val() && \r\n                   newTeacherSelect.val() && \r\n                   $('#reason').val().trim();\r\n        }\r\n    };\r\n    \r\n    return {\r\n        init: init\r\n    };\r\n});"],"names":["define","$","Ajax","Notification","init","categorySelect","courseSelect","currentTeacherSelect","newTeacherSelect","submitBtn","on","categoryId","this","val","prop","call","methodname","args","categoryid","parseInt","done","response","empty","append","M","util","get_string","courses","length","each","index","course","id","fullname","fail","error","alert","message","loadCourses","courseId","courseid","teachers","teacher","username","loadTeachers","availableteachers","loadAvailableTeachers","e","trim","preventDefault"],"mappings":"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"}